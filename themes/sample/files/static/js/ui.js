(function(){var d,l,t,u,e,v,w,x,q,r,y,m,n,p,g;x={volume:function(a,b){a.slider({max:1,step:0.05,slide:function(a,j){b.broadcast("uStudioUI.interacting",[]);b.broadcast("Player.changeVolume",[{level:j.value}])}});b.subscribe("Player.volumechange",function(b){a.slider("option","value",b.volume)})},progress:function(a,b){var c=!1;a.slider({duration:0,step:0.1,start:function(){c=!0;b.broadcast("uStudioUI.startInteraction",[])},stop:function(a,d){c=!1;b.broadcast("uStudioUI.stopInteraction",[]);b.broadcast("Player.seekto",
[{value:d.value}])}});b.subscribe("Player.durationchange",function(b){a.slider("option","max",b.duration)});b.subscribe("Player.timeupdate",function(b){c||a.slider("option","value",b.currentTime)})}};u=function(a){a=a.data("player-actions").split(",");var b,c,j,d,f=[],k;for(b=0;b<a.length;b++)j=$.trim(a[b]).split("="),c=j[0],j=j[1],c?j?(d=t[j])?f.push({name:j,event:c,action:d}):console.log('-- Unknown player action "'+j+'"'):console.log("-- Missing / unknown action name: "+j):console.log("-- Missing / unknown event name: "+
c);f.each=f.each||function(a){for(k=0;k<f.length;k++)a(f[k])};return f};v=function(a,b){u(a).each(function(c){var j=w[c.name];j?j(a,c,b):console.log("-- No bind behavior for action: "+c.name)})};e=function(a,b,c){a.bind(b.event,function(){return b.action(a,c)})};w={play:e,pause:e,mute:e,unmute:e,"playlist-next":e,"playlist-previous":e,"playlist-select-video":e,"play-pause-toggle":function(a,b,c){a.attr("data-player-play-state","paused");c.subscribe("Player.playing",function(){a.attr("data-player-play-state",
"playing")});c.subscribe("Player.paused",function(){a.attr("data-player-play-state","paused")});return e(a,b,c)},"mute-unmute-toggle":function(a,b,c){a.attr("data-player-mute-state","unmuted");c.subscribe("Player.mute",function(b){b.muted?a.attr("data-player-mute-state","muted"):a.attr("data-player-mute-state","unmuted")});return e(a,b,c)},"hq-toggle":function(a,b,c){a.attr("data-player-hq-state","best-fit");return e(a,b,c)},"captions-toggle":function(a,b,c){a.attr("data-player-captions-state","hidden");
return e(a,b,c)},"fullscreen-toggle":function(a,b,c){a.attr("data-player-fullscreen-state","normal");$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){a.attr("data-player-fullscreen-state",q()?"fullscreen":"normal")});return e(a,b,c)}};l=function(a,b){return function(c,j){j.broadcast(a,b);return!1}};t={play:l("Player.play",[]),pause:l("Player.pause",[]),mute:l("Player.mute",[{muted:!0}]),unmute:l("Player.mute",[{muted:!1}]),"playlist-next":l("Playlist.nextVideo",
[]),"playlist-previous":l("Playlist.previousVideo",[]),"playlist-select-video":function(a,b){var c=$(a),c=c.attr("id").replace(RegExp("^"+c.attr("data-player-repeat-id-prefix")),"");b.broadcast("uStudioUI.selectVideo",[{id:c}]);return!1},"play-pause-toggle":function(a,b){"playing"==a.attr("data-player-play-state")?b.broadcast("Player.pause"):b.broadcast("Player.play")},"mute-unmute-toggle":function(a,b){b.broadcast("Player.mute",[{muted:"muted"!=a.attr("data-player-mute-state")}])},"hq-toggle":function(a,
b){var c="hq"==a.attr("data-player-hq-state")?"best-fit":"hq";a.attr("data-player-hq-state",c);b.broadcast("qualityToggled",[{max:"best-fit"==c?720:0,state:c}])},"captions-toggle":function(a,b){var c="showing"===("showing"===a.attr("data-player-captions-state")?"hidden":"showing")?"showCaptions":"hideCaptions";b.broadcast(c)},"fullscreen-toggle":function(a,b){b.broadcast(q()?"fullscreen-off":"fullscreen-on",[{source:g[0].source}])}};var z=function(a){var b=$('[data-player-container="fullscreen"]')[0],
c=document.exitFullscreen||document.cancelFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullscreen||document.webkitCancelFullScreen,j=b.requestFullscreen||b.requestFullScreen||b.mozRequestFullScreen||b.webkitRequestFullscreen||b.webkitRequestFullScreen;j&&($(document).one("fullscreenerror mozfullscreenerror webkitfullscreenerror",function(){a.broadcast("fullscreen-failed");return!1}),m=function(){j.call(b)});c&&(n=function(){c.call(document)})},C=["webkit",
"moz","o","ms"],s=function(a){return a.charAt(0).toLowerCase()+a.substr(1)},D={fullscreen:function(){for(var a=0,b;(b=C[a++])&&!document[b+"CancelFullScreen"];);return b?document[b+"FullScreenEnabled"]||document[b+"FullscreenEnabled"]:(document[s("CancelFullScreen")]||document.exitFullscreen||document.cancelFullscreen)&&(document[s("FullScreenEnabled")]||document[s("FullscreenEnabled")])}};d=function(a,b,c){this._events=b;this._configuration=a;this._videos=c;this._template=a.template_url;this._idleTimeout=
3E3;this._currentVideo=this._videos[0];this._initialState=(this._shouldAutoplay=a.autoplay||!1)?"loading":"waiting";this._captionsVisible=this._captionsAvailable=!1;this._lastMove={};window.uStudioUI[this._configuration.template_callback_name]=A(this._loadTemplate,this);b.subscribe("start",this._onStart,this);b.subscribe("uStudioUI.templateLoaded",this._onTemplateLoaded,this);b.subscribe("resize",this._onResize,this);b.subscribe("uStudioUI.changeState",this._changeState,this);b.subscribe("uStudioUI.selectVideo",
this._selectVideo,this);b.subscribe("Player.fullready",this._onFullReady,this);b.subscribe("Player.playing",this._onPlay,this);b.subscribe("Player.paused",this._onPause,this);b.subscribe("Player.durationchange",this._onDurationChange,this);b.subscribe("Player.timeupdate",this._onTimeUpdate,this);b.subscribe("Player.volumechange",this._onVolumeChange,this);b.subscribe("Player.loaded",this._onLoaded,this);b.subscribe("Player.buffered",this._onBufferChange,this);b.subscribe("Player.waiting",this._onWaiting,
this);b.subscribe("Player.sourceChanging",this._onSourceChanging,this);b.subscribe("Player.error",this._onError,this);b.subscribe("no-transcodes-available",this._onNoTranscodesAvailable,this);b.subscribe("Playlist.videoSelected",this._onVideoSelected,this);b.subscribe("Playlist.ended",this._onPlaylistEnded,this);b.subscribe("Quality.selectedQuality",this._onSelectedQuality,this);b.subscribe("captionsAvailable",this._onCaptionsAvailable,this);b.subscribe("captionsUnavailable",this._onCaptionsUnavailable,
this);b.subscribe("captionsVisible",this._onCaptionsVisible,this);b.subscribe("captionsHidden",this._onCaptionsHidden,this);b.subscribe("fullscreen-capable",this._onFullscreenCapable,this);b.subscribe("fullscreen-change",this._onFullscreenChange,this);b.subscribe("fullscreen-failed",this._onFullscreenFailed,this);b.subscribe("fullscreen-on",this._activateFullscreen,this);b.subscribe("fullscreen-off",this._deactivateFullscreen,this)};var A=function(a,b){return function(){return a.apply(b,arguments)}};
d.prototype._onStart=function(){var a=this,b=$(window),c=document.createElement("script");m=n=p=g=void 0;c.src=a._template;c.type="text/javascript";document.getElementsByTagName("body")[0].appendChild(c);b.resize(function(){a._events.broadcast("resize",[{width:b.width(),height:b.height()}])})};d.prototype._onCaptionsAvailable=function(){this._captionsAvailable=!0;var a=$('[data-player-captions="true"]');a.show();this._elementResize(a.parent())};d.prototype._onCaptionsUnavailable=function(){this._captionsAvailable=
!1;var a=$('[data-player-captions="true"]');a.hide();this._elementResize(a.parent())};d.prototype._onCaptionsVisible=function(){this._captionsVisible=!0;$('[data-player-actions="click=captions-toggle"]').attr("data-player-captions-state","showing")};d.prototype._onCaptionsHidden=function(){this._captionsVisible=!1;$('[data-player-actions="click=captions-toggle"]').attr("data-player-captions-state","hidden")};d.prototype._bindVideoAttributes=function(){var a=this;$("[data-player-video-attribute]").each(function(){var b=
$(this),c=b.attr("data-player-video-attribute");b.text(a._currentVideo[c])})};d.prototype._bindVideoImages=function(){var a=this,b,c;for(b=0;b<this._currentVideo.images.length;b++)c=this._currentVideo.images[b],$('[data-player-container="'+c.type+'"]').each(function(){var b=$(this),h;b.finish();h=b.clone();h.find("img").remove();b.replaceWith(h);b=h;h=c.image_url;var f=new window.Image;f.onload=function(){var c=$('<img data-player-vertical-position="center" data-player-aspect-ratio="true" data-player-horizontal-position="center"/>');
$.each(d.DYNAMIC_IMAGE_PROPERTIES,function(a,b){c.attr(b,f[b])});b.append(c);a._forceResize()};f.src=h})};d.prototype._onTemplateLoaded=function(){var a=this,b=$("[data-player-idle-timeout-seconds]"),c;0===a._videos.length&&a._onError({name:"video-missing",message:""});1>=a._videos.length&&$('[data-player-playlist="true"]').each(function(){$(this).remove()});D.fullscreen()&&a._events.broadcast("fullscreen-capable",[{source:"ui",weight:50}]);$('[data-player-repeat-per="video"]').each(function(){var b=
$(this),c=b.parent(),d=b.attr("data-player-repeat-id-prefix"),k=b.attr("data-player-repeat-width"),g;b.remove();"percentage"===k&&a._videos.length&&(g=Math.floor(10*(100/a._videos.length))/10+"%");for(k=0;k<a._videos.length;k++){var e=b.clone();e.attr("id",d+a._videos[k].id);a._videos[k].id===a._currentVideo.id&&e.attr("data-player-selected-video-class")&&e.addClass(e.attr("data-player-selected-video-class"));g&&e.css("width",g);c.append(e)}});$("[data-player-actions]").each(function(){v($(this),
a._events)});a._currentVideo&&(a._bindVideoAttributes(),a._bindVideoImages());$("[data-player-touch-classes]").each(function(){c=$(this);var a=$(this).attr("data-player-touch-classes").split(",");void 0===window.ontouchstart?c.addClass(a[1]):c.addClass(a[0])});$('[data-player-container="player"]').append('<div id="player" style="width: 100%; height: 100%;"/>');this._updateDuration();$("[data-player-slider]").each(function(){var b=$(this),c=b.data("player-slider"),d=x[c];d?d(b,a._events):console.log("-- No bind behavior for slider name: "+
c)});0<b.length&&(a._idleTimeout=1E3*parseInt(b.attr("data-player-idle-timeout-seconds"),10));$('[data-player-interaction="true"]').mousemove(A(a._onMouseMove,a));$("[data-player-prevent-contextmenu]").on("contextmenu",!1);b=a._captionsAvailable?"show":"hide";$('[data-player-captions="true"]')[b]();g&&0<g.length&&this._enableFullscreen();this._templateLoaded=!0;this._forceResize();this._events.broadcast("uStudioUI.changeState",[{state:this._initialState}]);this._events.broadcast("Player.build",["player"])};
var B=[{className:"media-desktop-width",width:900},{className:"media-tablet-width",width:540},{className:"media-mobile-width",width:300},{className:"media-tiny-width",width:0}];d.prototype._elementResize=function(a){a.find('[data-player-width="auto"]').each(function(){var a=this,c=$(a),d=$(c.parent()),h=0;d.children().each(function(){this!=a&&"none"!==$(this).css("display")&&(h+=$(this).outerWidth(!0))});h+=0.02*h;c.width(Math.floor(d.innerWidth())-Math.ceil(h))});a.find("[data-player-aspect-ratio]").each(function(){var a=
$(this),c=a.width(),d=a.height(),h=c/d,f=$(a.parent()),k=f.innerWidth(),f=f.innerHeight(),e=k,g=f;h>k/f?g=k/c*d:e=f/d*c;a.width(e);a.height(g)});a.find('[data-player-vertical-position="center"]').each(function(){var a=$(this.parentElement),c=$(this),a=Math.round((a.innerHeight()-c.height())/2);c.css({top:a+"px",position:"absolute"})});a.find("[data-player-horizontal-position]").each(function(){var a=$(this.parentElement),c=$(this),d=c.attr("data-player-horizontal-position");"center"===d?(a=Math.round((a.innerWidth()-
c.width())/2),c.css({left:a+"px",position:"absolute"})):"left"===d?c.css({left:"0px",position:"absolute"}):"right"===d&&c.css({right:"0px",position:"absolute"})});a.find('[data-player-vertical-position="bottom"]').each(function(){$(this).css({position:"absolute",bottom:"0px"})})};d.prototype._onResize=function(a){var b=$("body"),c=a.width,d,h,f,e;for(d=0;e=B[d];d++)b.hasClass(e.className)&&(f=e.className);for(d=0;e=B[d];d++)if(c>=e.width){h=e.className;break}f?h!==f&&b.toggleClass([h,f].join(" ")):
b.addClass(h);$('[data-player-width="full"]').each(function(){var b=$(this);b.width(Math.floor(a.width-(b.outerWidth(!0)-b.innerWidth())))});$('[data-player-height="full"]').each(function(){var b=$(this);b.height(Math.floor(a.height-(b.outerHeight(!0)-b.innerHeight())))});this._elementResize(b)};y={fade:{hide:function(a){a.fadeOut()},show:function(a){a.fadeIn()}},none:{hide:function(a){a.hide()},show:function(a){a.show()}}};d.prototype._changeState=function(a){this._templateLoaded?this._currentState!=
a.state&&(this._previousState=this._currentState,this._currentState=a.state,$("[data-player-current-state]").each(function(){this.setAttribute("data-player-current-state",a.state)}),$("[data-player-states]").each(function(){var b=$(this).finish(),c=-1<b.data("player-states").indexOf(a.state),d=b.data("player-state-transition")||"none",e=y[d],f="none"==b.css("display");if(!c||f)if(c||!f)e?c?e.show(b):e.hide(b):console.log("-- Unknown state transition: "+d)})):this._initialState=a.state};d.prototype._onFullReady=
function(){this._events.broadcast("UI.ready")};d.prototype._loadTemplate=function(a){$("body").append(a);this._events.broadcast("uStudioUI.templateLoaded")};d.prototype._forceResize=function(){var a=$(window);this._onResize({width:a.width(),height:a.height()})};d.prototype._resetInteractionTimer=function(){var a=this;"undefined"!==typeof a._interactionTimer&&clearTimeout(a._interactionTimer);a._interactionTimer=setTimeout(function(){a._events.broadcast("uStudioUI.changeState",[{state:"idle"}])},a._idleTimeout)};
d.prototype._cancelInteractionTimer=function(){"undefined"!==typeof this._interactionTimer&&(clearTimeout(this._interactionTimer),this._interactionTimer=void 0)};d.prototype._onMouseMove=function(a){this._lastMove.clientX===a.clientX&&this._lastMove.clientY===a.clientY||(this._lastMove=a,"idle"===this._currentState?this._events.broadcast("uStudioUI.changeState",[{state:this._previousState}]):("playing"===this._currentState||"paused"===this._currentState)&&this._resetInteractionTimer())};d.prototype._onPlay=
function(){this._events.broadcast("uStudioUI.changeState",[{state:"playing"}]);this._resetInteractionTimer();this._playing=!0};d.prototype._onPause=function(){this._events.broadcast("uStudioUI.changeState",[{state:"paused"}]);this._resetInteractionTimer()};d.prototype._updateDuration=function(){var a=r(this._duration);$('[data-player-text="duration"]').text(a)};d.prototype._selectVideo=function(a){for(var b=0;b<this._videos.length;b++)if(this._videos[b].id===a.id){this._events.broadcast("Playlist.selectVideo",
[{index:b}]);break}};d.prototype._onVideoSelected=function(a){var b=a.video.id;this._currentVideo=this._videos[a.video.index];this._duration=a.video.duration;this._bindVideoAttributes();this._bindVideoImages();$("[data-player-selected-video-class]").each(function(){var a=$(this);a.attr("id")===a.attr("data-player-repeat-id-prefix")+b?a.addClass(a.attr("data-player-selected-video-class")):a.removeClass(a.attr("data-player-selected-video-class"))});this._changingVideos=!0};d.prototype._onPlaylistEnded=
function(){this._shouldAutoplay=this._playing=!1;this._cancelInteractionTimer();this._events.broadcast("uStudioUI.changeState",[{state:"waiting"}]);g&&g.length&&this._events.broadcast("fullscreen-off",[{source:g[0].source}])};d.prototype._onSelectedQuality=function(a){$("[data-player-hq-state]").attr("data-player-hq-state",720<=a.height?"hq":"best-fit")};d.prototype._onDurationChange=function(a){this._duration=a.duration;this._updateDuration()};d.prototype._onTimeUpdate=function(a){var b=r(a.currentTime);
$('[data-player-text="current-time"]').text(b);this._duration&&$('[data-player-width="progress"]').width(100*(a.currentTime/this._duration)+"%")};d.prototype._onVolumeChange=function(a){$('[data-player-width="volume"]').width(100*a.volume+"%")};d.prototype._onLoaded=function(){(this._playing&&this._changingVideos||this._shouldAutoplay)&&this._events.broadcast("Player.play")};d.prototype._onBufferChange=function(a){$('[data-player-width="buffer"]').width(a.percentage+"%")};d.prototype._onWaiting=function(){this._cancelInteractionTimer();
this._events.broadcast("uStudioUI.changeState",[{state:"loading"}])};d.prototype._onSourceChanging=function(){this._playing&&(this._cancelInteractionTimer(),this._events.broadcast("uStudioUI.changeState",[{state:"swapping"}]))};d.prototype._onError=function(){this._events.broadcast("uStudioUI.changeState",[{state:"error"}])};d.prototype._onNoTranscodesAvailable=function(){this._events.broadcast("uStudioUI.changeState",[{state:"unavailable"}])};d.prototype._enableFullscreen=function(){this._elementResize($("button.fullscreen").show().parent())};
d.prototype._onFullscreenChange=function(a){p=a.state;$(document).trigger("fullscreenchange")};var E=function(a,b){return b.weight-a.weight};d.prototype._onFullscreenCapable=function(a){if(a&&a.source&&a.weight){var b=0,c;for(g||(g=[]);c=g[b++];)if(a.source==c.source)return;c||(g.push(a),g.sort(E));this._enableFullscreen()}};d.prototype._onFullscreenFailed=function(){g.splice(0,1);g.length?this._events.broadcast("fullscreen-on",[{source:g[0].source}]):this._elementResize($("button.fullscreen").hide().parent())};
d.prototype._activateFullscreen=function(a){"ui"==a.source&&(a=this._events,m||z(a),m(a))};d.prototype._deactivateFullscreen=function(a){"ui"==a.source&&(n||z(this._events),n(this._events))};d.DYNAMIC_IMAGE_PROPERTIES=["height","src","width"];q=function(){return void 0!==p?p:document.webkitFullscreenElement||document.mozFullScreenElement||document.fullscreenElement};r=function(a){a=Math.round(a);var b=(a-a%3600)/3600,c=(a%3600-a%60)/60;a%=60;var d=b?b+":":c+":";return b?d+(10>c?"0"+c:c):d+(10>a?"0"+
a:a)};window.uStudioUI=window.uStudioUI?window.uStudioUI:{};uStudio.uStudioCore.instance.registerModule({name:"uStudioUI",initialize:function(a,b,c,e){new d(a,b,c);e()},queryConfigMap:{autoplay:"autoplay"}})})();
